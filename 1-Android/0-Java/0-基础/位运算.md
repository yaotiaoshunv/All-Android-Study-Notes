> 知识路径：Android > Java > 位运算
>
> version：2021/4/5
>
> review：2021/4/5
>
> 掌握程度：入门



#### 前言

在Java的集合框架中，有大量对位运算的使用，想要彻底的理解集合源码，掌握位运算是必须的。

## 一、预备知识

原码、反码、补码（见：原码、反码、补码.md）

## 二、位运算

### 1、位运算概述

现代计算机中的所有数据都是以**二进制**的形式存储在设备中。有 0、1 两种状态。

举个例子来看下 CPU 是如何进行计算的，比如这行代码：

```java
int a = 35;
int b = 47;
int c = a + b;
```

计算两个数的和，因为在计算机中都是以二进制来进行运算，所以上面我们所给的 int 变量会在机器内部先转换为二进制再进行相加：

```java
35:  0 0 1 0 0 0 1 1
47:  0 0 1 0 1 1 1 1
————————————————————
82:  0 1 0 1 0 0 1 0
```

### 2、位运算概览

**位运算就是参加运算的两个数据，按二进制位进行（与、或、异或等）运算。**

| 符号 | 描述       | 运算规则                                       |
| ---- | ---------- | ---------------------------------------------- |
| &    | 与         | 有0为0                                         |
| \|   | 或         | 有1为1                                         |
| ^    | 异或       | 相同为0                                        |
| ~    | 取反       | 0变1，1变0                                     |
| <<   | 左移       | 左移若干位，高位丢弃，低位补0                  |
| >>   | 有符号右移 | 右移若干位，低位丢弃，正数高位补0，负数高位补1 |
| >>>  | 无符号右移 | 右移若干位，高位补0（不论正负）                |

### 3、按位与运算符 &

运算规则：有0为0

```
0&0=0  0&1=0  1&0=0  1&1=1
```

注意：负数按补码形式参加按位与运算。

#### 与运算的用途：

1）清零

如果想将一个单元清零，即使其全部二进制位为0，只要与一个各位都为零的数值（0）相与，结果为零

2）取一个数的指定位

比如取数 X=1010 1110 的低4位，只需要另找一个数Y，令Y的低4位为1，其余位为0，即Y=0000 1111，然后将X与Y进行按位与运算（X&Y=0000 1110）即可得到X的指定位。

3）判断奇偶

只要根据最未位是0还是1来决定，为0就是偶数，为1就是奇数。因此可以用**if ((a & 1) == 0)**代替if (a % 2 == 0)来判断a是不是偶数。

### 4、按位或运算符 |

运算规则：有1为1

```
0|0=0  0|1=1  1|0=1  1|1=1
```

注意：负数按补码形式参加按位或运算。

#### 或运算的用途：

1）常用来对一个数据的某些位设置为1

比如将数 X=1010 1110 的低4位设置为1，只需要另找一个数Y，令Y的低4位为1，其余位为0，即Y=0000 1111，然后将X与Y进行按位或运算（X|Y=1010 1111）即可得到。

### 5、异或运算符 ^

运算规则：相同为0

```
0^0=0  0^1=1  1^0=1  1^1=0
```

异或的几条性质:

- 1、交换律
- 2、结合律 (a^b)^c == a^(b^c)
- 3、对于任何数x，都有 **x^x=0，x^0=x**
- 4、自反性: a^b^b=a^0=a;

#### 异或运算的用途：

1）翻转指定位

比如将数 X=1010 1110 的低4位进行翻转，只需要另找一个数Y，令Y的低4位为1，其余位为0，即Y=0000 1111，然后将X与Y进行异或运算（X^Y=1010 0001）即可得到。

2）与0相异或值不变

例如：1010 1110 ^ 0000 0000 = 1010 1110

3）交换两个数

```java
void Swap(int a, int b){
  if (a != b){
    a ^= b;		// a = a ^ b;
    b ^= a;		// b = b ^ (a ^ b)	== a
    a ^= b;		// a = (a ^ b) ^ a == b
  }
}
```

### 6、取反运算符 (~)

运算规则：0变1，1变0

```java
~1 = 0
~0 = 1
```

#### 取反运算的用途：

1）使一个数的最低位为零

使a的最低位为0，可以表示为：a & ~1。~1的值为 1111 1111 1111 1110，再按"与"运算，最低位一定为0。因为" ~"运算符的优先级比算术运算符、关系运算符、逻辑运算符和其他运算符都高。

### 7、左移运算符 <<

定义：各二进制位全部左移若干位（左边丢弃，右边补0）

设 a = 1010 1110，a = a << 2 将a的二进制位左移2位、右补0，即得a = 1011 1000。

若左移时舍弃的高位不包含1，则每左移一位，相当于该数乘以2。

### 8、有符号右移运算符（>>）

定义：各二进制位全部右移若干位，正数左补0，负数左补1，右边丢弃。

例如：a=a>>2 将a的二进制位右移2位，左补0 或者 左补1得看被移数是正还是负。

操作数每右移一位，相当于该数除以2。

### 9、无符号右移运算符 >>>

不管正数还是负数，高位都用0补齐

```java
int rightShift = 10;
System.out.println("十进制:" + rightShift + ", 二进制:" + Integer.toBinaryString(rightShift));
int newRightShift = rightShift >>> 2;
System.out.println("右移2位后十进制:" + newRightShift + ", 右移2位后二进制" + Integer.toBinaryString(newRightShift));
```

以上是正整数，运算结果如下：

![img](https://images2015.cnblogs.com/blog/630246/201703/630246-20170322233838393-486835570.png)

接下来看负整数，运算结果如下：

![img](https://images2015.cnblogs.com/blog/630246/201703/630246-20170322233959908-2087469477.png)

需要注意-10的二进制右移2位后，高位缺失的两个00是没有打印出来的。现在的二进制数就等于正数的原码。

### 10、其他补充

不同长度的数据进行位运算：如果两个不同长度的数据进行位运算时，系统会将二者按右端对齐，然后进行位运算。

以"与运算"为例说明如下：我们知道在C语言中long型占4个字节，int型占2个字节，如果一个long型数据与一个int型数据进行"与运算"，右端对齐后，左边不足的位依下面三种情况补足，

- 1）如果整型数据为正数，左边补16个0。
- 2）如果整型数据为负数，左边补16个1。
- 3）如果整形数据为无符号数，左边也补16个0。
- 如：long a=123；int b=1；计算a & b。

- 如：long a=123；int b=-1；计算a & b。

- 如：long a=123；unsigned intb=1；计算a & b。







**参考：**

1、[(位运算（&、|、^、~、>>、<<）](https://www.runoob.com/w3cnote/bit-operation.html)

2、[<<、>>、>>>移位操作](https://www.cnblogs.com/yulinfeng/p/6602902.html)

http://www.matrix67.com/blog/archives/263

http://www.matrix67.com/blog/?s=%E4%BD%8D%E8%BF%90%E7%AE%97

https://cuiqingcai.com/6841.html



https://blog.csdn.net/zhouhao88410234/article/details/90667775

https://www.cnblogs.com/life-of-coding/p/12066962.html

https://www.freesion.com/article/83921408575/

http://t.zoukankan.com/wmqiang-p-11681780.html



https://blog.csdn.net/jarvan5/article/details/115010477